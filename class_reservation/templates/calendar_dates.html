{% extends "index.html" %}
{% load static %}

{% block content %}
<style>
    /* Estilos CSS aquí */
    #calendar {
        max-width: 800px;
        margin: 0px 20px;
        padding: 20px;
        background-color: #fff;
     
      
    }

    header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
    }

    table {
        width: 100%;
        border-collapse: collapse;
    }

    th, td {
        padding: 8px;
        text-align: center;
        font-size: 14px;
    }

    th {
        background-color:white;
        color: rgb(213, 213, 213);
      
    }

    td {
        
        transition: background-color 0.3s;
        width: 14.28%; /* Ajuste para 7 columnas en una fila */
    }

    td:hover {
        background-color: #f2f2f2;
        cursor: pointer;
    }

    .selected {
        background-color: #4285f4;
        color: #fff;
    }

    .appointment {
        background-color: pink;
        color: #fff;
        font-weight: bold;
        padding: 5px;
        border-radius: 4px;
    }

    .schedule {
        margin-top: 20px;
    }
</style>

<div class="content" style="background-color: rgb(228, 228, 228); width: 100%; height: 100%; align-items: center;">

    <div class="" style="color: black; width: 85%;  background-color:white;  margin: 0px auto;">

        <div style="margin: 20px; padding-top: 20px;"> <a href="{% url 'home' %}"> <i class=" fa fa-solid fa-chevron-left"></i> Back</a ></div>

        <h2 style="margin: 20px; margin-top: 40px; font-weight: 900;"> Private Cooking Class - Holiday Special</h2>
        <p style="margin-left: 20px;">Ready to talk now? Call us at +1 (213) 123-1234.</p>
        <hr style="width: 95%; border:0.3px solid black; margin: auto;">
        <h3 style="margin-left: 20px; margin-top: 40px; font-weight: 900; font-size: 20px;">Select a Date and Time</h3>
        <hr style="width: 60%; border:0.3px solid black; margin-left: 20px;">
        <div id="calendar" style="display: flex; ">
        </div>

    </div>

</div>

<script>
    let selectedDate = new Date();

    function changeMonth(delta) {
        selectedDate.setMonth(selectedDate.getMonth() + delta);
        renderCalendar();
    }

    function selectDate(day) {
        selectedDate = new Date(selectedDate.getFullYear(), selectedDate.getMonth(), day);
        renderCalendar();
    }

    function renderCalendar() {
        console.log("Rendering calendar for", selectedDate);
        const calendarContainer = document.getElementById("calendar");
        const calendar = `
          <div>
            <header style="display:flex; " >
              <button onclick="changeMonth(-1)" style=" background:white;border:1px solid white ;" ><i class=" fa fa-solid fa-chevron-left"></i></button>
              <p>${getMonthName(selectedDate.getMonth())}      ${selectedDate.getFullYear()}<p>
              <button onclick="changeMonth(1)" style=" background:white;border:1px solid white ;""><i class="fa fa-solid fa-chevron-right"></i></button>
            </header>
            <table>
              <thead>
                <tr>
                  <th>D</th>
                  <th>L</th>
                  <th>M</th>
                  <th>M</th>
                  <th>J</th>
                  <th>V</th>
                  <th>S</th>
                </tr>
              </thead>
              <tbody>
                ${generateCalendarBody()}
              </tbody>
            </table>
          </div>
          <div class="schedule" style="margin: 0px 40px; ">
            <h4 style="font-size:15px">Horarios de citas para ${getFormattedDate(selectedDate)}</h4>
            <div style="display:flex; wrap: wrap;">
            ${getAppointmentsForDate(selectedDate).map(appointment => `<div class="appointment" style= "background:white; color: black ; width: 50%; border:1px solid black;">${appointment}</div>`).join('')}
            </div>
            </div>
        `;
        calendarContainer.innerHTML = calendar;
        updateSelectedDate();
    }

    function generateCalendarBody() {
        const firstDayOfMonth = new Date(selectedDate.getFullYear(), selectedDate.getMonth(), 1);
        const lastDayOfMonth = new Date(selectedDate.getFullYear(), selectedDate.getMonth() + 1, 0);
        const daysInMonth = lastDayOfMonth.getDate();
        const firstDayOfWeek = firstDayOfMonth.getDay();

        let calendarBody = "";

        // Rellenar celdas vacías antes del primer día del mes
        for (let i = 0; i < firstDayOfWeek; i++) {
            calendarBody += "<td></td>";
        }

        // Rellenar días del mes
        for (let day = 1; day <= daysInMonth; day++) {
            const currentDate = new Date(selectedDate.getFullYear(), selectedDate.getMonth(), day);
            const isToday = isSameDate(currentDate, new Date());

            console.log("Rendering day:", day, "Today?", isToday, "Selected?", isSameDate(currentDate, selectedDate));

            calendarBody += `
                <td class="${isToday ? 'today' : ''} ${isSameDate(currentDate, selectedDate) ? 'selected' : ''}" onclick="selectDate(${day})">
                    ${day}
                    ${getAppointmentsForDate(currentDate).length > 0 ? '<div class="appointment"></div>' : ''}
                </td>
            `;

            // Si es el último día de la semana o el último día del mes, cerrar la fila
            if ((firstDayOfWeek + day - 1) % 7 === 6 || day === daysInMonth) {
                calendarBody = `<tr>${calendarBody}</tr>`;
            }
        }

        return calendarBody;
    }

    function updateSelectedDate() {
        const monthYearElement = document.querySelector("header h2");
        monthYearElement.innerHTML = `${getMonthName(selectedDate.getMonth())} ${selectedDate.getFullYear()}`;
    }

    function isSameDate(date1, date2) {
        return (
            date1.getFullYear() === date2.getFullYear() &&
            date1.getMonth() === date2.getMonth() &&
            date1.getDate() === date2.getDate()
        );
    }

    function getMonthName(month) {
        const monthNames = [
            "Enero", "Febrero", "Marzo", "Abril", "Mayo", "Junio",
            "Julio", "Agosto", "Septiembre", "Octubre", "Noviembre", "Diciembre"
        ];
        return monthNames[month];
    }

    function getFormattedDate(date) {
        const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
        return date.toLocaleDateString('es-ES', options);
    }

    function getAppointmentsForDate(date) {
        return [
            "10:00 AM ",
            "02:00 PM "
        ];
    }

    renderCalendar();
</script>
{% endblock %}
